   VERSION=( "3.10.17" "3.10.16" "3.10.15" "3.10.13" )
  CATEGORY="utility"
 ATTRIBUTE="console"
    SOURCE="apcupsd/apcupsd-$VERSION"
  HOMEPAGE="http://www2.apcupsd.com"
       URL="$SOURCEFORGE_URL"
       REQ=( "system-logger email-client"
          "tcp_wrappers:--with-libwrap=/usr/lib::for an optional method of controlling access"
          "ncurses:--enable-powerflute::for the optional powerflute curses-based control panel"
          "httpd:--enable-cgi --with-cgi-bin=/usr/share/httpd/cgi-bin::and build CGI programs to permit web access to apcupsd data"
	  )
  ESTIMATE="238"
 FRESHMEAT="apcupsd"
      DESC="apcupsd manages and controls most of APC's UPS models
apcupsd can be used for power mangement and controlling 
most of APC's UPS models on Unix and Windows machines. 
Apcupsd works with most of APC's Smart-UPS models as well 
as most simple signalling models such a Back-UPS, and 
BackUPS-Office. During a power failure, apcupsd will inform 
the users about the power failure and that a shutdown may 
occur. If power is not restored, a system shutdown will 
follow when the battery is exhausted, a timeout (seconds) 
expires, or runtime expires based on internal APC calculations 
determined by power consumption rates.
"
build() {

 ./configure     --build=$BUILD                                  \
                 --prefix=/usr                                   \
                 --sysconfdir=/etc/apcupsd                       \
                 --localstatedir=/var                            \
                 --enable-usb                                    \
                 --with-log-dir=/var/log                         \
                 --with-serial-dev=/dev/usb/hiddev[0-15]         \
                 $OPTS                                           &&

 make                    &&
 prepare_install         &&
 make  install           &&

 ( if [ -f /etc/rc0.d/S90halt ]; then
         rm  /etc/rc0.d/S90halt
         ln  -s /etc/init.d/halt.sh /etc/rc0.d/S99halt
   fi
 )			 &&

 install  -m 0754  $SCRIPT_DIR/apcupsd $SCRIPT_DIR/UPSdown /etc/init.d   &&

 ln  -sf /etc/init.d/apcupsd /etc/rc0.d/K79apcupsd       &&
 ln  -sf /etc/init.d/UPSdown /etc/rc0.d/K98UPSdown       &&
 ln  -sf /etc/init.d/apcupsd /etc/rc1.d/K79apcupsd       &&
 ln  -sf /etc/init.d/apcupsd /etc/rc2.d/S20apcupsd       &&
 ln  -sf /etc/init.d/apcupsd /etc/rc3.d/S20apcupsd       &&
 ln  -sf /etc/init.d/apcupsd /etc/rc4.d/S20apcupsd       &&
 ln  -sf /etc/init.d/apcupsd /etc/rc5.d/S20apcupsd       &&
 ln  -sf /etc/init.d/apcupsd /etc/rc6.d/K79apcupsd

}

pre_remove() {
 /etc/init.d/apcupsd  stop
}

post_install() {
 /etc/init.d/apcupsd  start
}


